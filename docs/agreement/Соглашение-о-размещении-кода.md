# Соглашение о размещении кода

**Цель:** унифицировать структуру каталогов, правила размещения и именования исходного кода, а также практики работы с окружениями и мок-сервером, чтобы обеспечить читаемость, предсказуемость и масштабируемость проекта. Основано на актуальной структуре проекта (MVC: Model — model, Controller — service, View — view), доменном разбиении и сопутствующей документации.

---

## Структура проекта

Проект построен отталкиваясь от архитектуры MVC (Model — model, Controller — service, View — view) с чётким разделением ответственности между слоями и групировкой
по доменным областям (напр. `model/user/user.validation-scheme.ts`, `view/entity/user/UserTable.vue`). Основной код размещён в папке `src`.


## View Layer (`src/view`)

Компоненты пользовательского интерфейса сгруппированы по уровням абстракции:

- **`entity/`** — атомарные UI-компоненты, представляющие отдельные бизнес-сущности.
- **`feature/`** — составные компоненты, реализующие конкретную бизнес-функциональность. Могут включать несколько `entity`.
- **`widget/`** — высокоуровневые компоненты из `feature` и `entity`
- **`pages/`** — компоненты страниц, используемые маршрутизатором. Обычно содержат несколько `widget`.
- **`layout/`** — компоненты макета: шапки, боковые панели и другие элементы общего интерфейса, так же как и страницы содержат `widget`.

**Примеры:**
- `entity/user/UserAvatar.vue`
- `feature/user/UserProfileForm.vue`
- `widget/user/UserProfileCard.vue`
- `layout/default/DefaultLayout.vue`

## Model Layer (`src/model`)

Содержит:

* Доменные модели и типы.
* Схемы валидации данных (например, через Zod).

Могут примениться по всему проекту. Не должен содержать внешних зависимостей (исключая библиотечные импорты).

## Service Layer (`src/service`)

Здесь размещается бизнес-логика и работа с внешними API или локальными хранилищами.
Сервисы изолированы и не зависят от UI.

Основное:

* Логика контроля элементов сайдбара (добавить/удалить/блокировать и.т.д)
* Бизнес-логика (фильтрации, конвертации, получение данных по api)
* Кэширование данных реализуется внутри сервисов.
* Каждый сервис отвечает за одну конкретную задачу (Single Responsibility Principle).

## Store (`src/store`)

Общее состояние, доступное нескольким компонентам (используется библиотека Pinia).
Особенности:

* Используется только для реактивного хранения данных.
* Не содержит бизнес-логики.

## Конфигурация (`src/config`)

Константы, ключи, настройки окружения.

> ⚠ Не допускается размещение логики. Все вычисления и обработка должны выполняться в `service`.

---

## Базовые принципы

1. Разделение по слоям и доменам: код группируется и по архитектурному слою, и по предметной области (например, `model/user/*`, `view/entity/user/*`). Так мы сохраняем локализацию знаний и изоляцию зависимостей.
2. Одноответственность, читаемость, предсказуемость: каждый модуль решает одну задачу; минимизируйте скрытые зависимости и смешение слоёв. Эти принципы оговорены как общие для структуры и именования.

---

## Размещение файлов по слоям (практика)

* **Валидации** — в `src/model/<domain>/<domain>.validation-scheme.ts`.
* **Типы/модели** — в `src/model/<domain>/*.ts` (напр., `<domain>.types.ts`).
* **Сервисы** — в `src/service/<domain>/*.service.ts` и соседние интеграции (`*.api.ts`). Кэширование и адаптеры — внутри сервиса.
* **Хранилище** — в `src/store/<domain>.store.ts` с минимальной логикой и реактивными данными.
* **Компоненты** — в `src/view/{entity|feature|widget|pages|layout}/<domain>/*.vue` согласно уровню.
* **Конфигурации** — в `src/config/*.ts` (только константы/настройки). Логику — в сервисы.

---

## Антипаттерны и запреты

* Нельзя размещать бизнес-логику в `src/view`, `src/store` и `src/config`. Вся логика — в `src/service`.
* Нельзя смешивать уровни абстракции UI: **entity** не должен знать о сценариях **feature**, а **feature** — о собирательной роли **widget** (наоборот — можно).
* Нельзя нарушать принципы именования и одноответственности модулей.

---

## Пример размещения для новой возможности

**Задача:** Добавить сценарий входа в систему.

* Модели/типы: `src/model/auth/auth.types.ts`.
* Схемы валидации: 
  * `src/model/auth/login.validation-scheme.ts`.
  * `src/model/auth/register.validation-scheme.ts`.
  * `src/model/auth/password-recovery.validation-scheme.ts`.
* API-клиент: `src/service/auth/auth.api.ts`.
* Сервис: `src/service/auth/login.service.ts` (логика авторизации, запись токена в `auth.store`).
* Хранилище: `src/store/auth.store.ts` (храним JWN токен, без бизнес-логики).
* UI:
    * `src/view/entity/auth/LoginForm.vue` — форма авторизации.
    * `src/view/entity/auth/PasswordRecoveryForm.vue` — форма восстановления пароля.
    * `src/view/entity/auth/RegistrationForm.vue` — форма регистрации.
    * `src/view/feature/auth/Login.vue` — сценарйи авторизации.
    * `src/view/feature/auth/ForgotPassword.vue` — сценарий восстановления пароля.
    * `src/view/feature/auth/Register.vue` — сценарий регистрации.
    * `src/view/widget/auth/AuthWidget.vue` — композиция для страницы, переходы между логином, регистрацией, восстановлением пароля.
    * `src/view/pages/auth/AuthPage.vue` — позиционирование виджета на странице, название страницы.  

---

## Изменения и версия документа

Соглашение актуально на момент публикации и обновляется по мере развития архитектуры. При изменениях в структуре проекта или инструментах соответствующие разделы пересматриваются и дополняются ссылками на исходные регламенты.

---

### Краткий чек-лист перед PR

* [ ] Файлы расположены по слоям и доменам.
* [ ] Имена соответствуют шаблонам и роли компонента/модуля.
* [ ] Бизнес-логика — только в сервисах; store и config без логики.
* [ ] Валидации/типы в `model`, UI-уровни не смешаны.
* [ ] Для разработки с фейковым API используется `.env.mock` + мок-сервер. 
* [ ] Пройдены `type-check`, `lint`, `test:unit`.